<div class="menu-layout">
  <%= render 'shared/menu' %>
  <div class="content">
    <%= render 'tasks/top_menu' %>
    <div class="task__content">
      <div class="content__header">
        <h1>Create brand mood boards</h1>
        <p class='text-muted'>Assemble three distinct mood boards for client consideration</p>
      </div>
      <%= render 'tasks/assignments', task: @task %>
      <div class="checklist__bar" style='margin-bottom: 1rem'>
        <% @checklist_size = @task.checklist_items.size %>
        <% @task.checklist_items.order(completed: :desc).each do |item| %>
          <div class='bar__step <%= 'bar__step-completed' if item.completed %>'
               style="width: <%= 100.fdiv(@checklist_size).round(2) %>%;"
               aria-valuenow='<%= 100.fdiv(@checklist_size).round(2) %>'
               aria-valuemin="0"
               aria-valuemax="100">
          </div>
        <% end %>
      </div>
      <div class="d-flex justify-content-between align-items" style='margin-bottom: 2rem;'>
        <div class="icons">
          <i class="fas fa-bars bars-icon"></i>
          <i class="fas fa-check check-icon"></i>
          <span><%= @checklist_size %></span>
        </div>
        <p class='mb-0'>Due <%= time_ago_in_words(@task.expected_end_date) %></p>
      </div>
      <div class="board" data-controller='task-board'>
        <div class="board__sections">
          <ul>
            <% %w[ Task File Activity ].each do |section| %>
              <%= content_tag :li, section.capitalize, class: "#{'active active-hover' if section == 'Task'}", data: { action: 'click->task-board#changeSection', task_board_target: 'section'} %>
            <% end %>
          </ul>
        </div>
        <div class="section" data-controller='filter'  data-filter-url-value='<%= task_checklist_items_path(@task) %>'>
          <div class="section__header">
            <div class="section__header_title">
              <span class='filter'>
                <i class="fas fa-sort" data-action='click->filter#display'></i>
                <div class="filter__pop input--hide"
                     data-filter-target='popup'
                     data-action='mouseleave->filter#hide'>
                  <%= button_tag 'Completed', type: 'button', class: 'clean_button', data: { action: 'click->filter#update',  } %>
                </div>
              </span>
              <h3>Checklist</h3>
              <%= button_tag '+', type: 'button', class: 'btn__plus' %>
            </div>
            <%= form_tag task_checklist_items_path(@task), method: :get do %>
              <%= text_field_tag :filter, params[:filter], placeholder: 'Search...' %>
            <% end %>
          </div>
          <div class="section__content">
            <ul data-controller='sortable' data-filter-target='list'>
              <% @task.checklist_items.each do |item| %>
                <li class="item__row">
                  <%= button_tag type: 'button', class: 'butones', style: 'border: 0; padding: 0; text-align: start; opacity: 0.5;' do %>
                    <i class="fas fa-grip-lines"></i>
                  <% end %>
                  <div class="item__completed" >
                    <input type="checkbox" name="completed" id="<%= dom_id(item) %>" <%= 'checked' if item.completed %> class="ignore-elements">
                    <%# <div class="checkbox"></div> %>
                  </div>
                  <p class="ignore-elements"><%= item.content %></p>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
